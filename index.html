<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ª´ v·ª±ng ti·∫øng Trung </title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <h1>üìö T·ª´ v·ª±ng ti·∫øng Trung</h1>

        <div class="tabs">
            <button class="tab active" onclick="showTab('vocabulary')">üìñ T·ª´ v·ª±ng</button>
            <button class="tab" onclick="showTab('add-word')">‚ûï Th√™m t·ª´ m·ªõi</button>
            <button class="tab" onclick="showTab('exercise')">‚úèÔ∏è L√†m b√†i t·∫≠p</button>
            <button class="tab" onclick="showTab('flashcards')">üÉè Flashcards</button>
            <button class="tab" onclick="showTab('manager')">üóÇÔ∏è Qu·∫£n l√Ω</button>
            <button class="tab" onclick="showTab('download')">üì• T·∫£i xu·ªëng</button>
            <button class="tab" onclick="showTab('progress')">üìä Ti·∫øn ƒë·ªô</button>
            <!-- <label class="inline-label" style="justify-content:center;">
                <input id="toggleDark" type="checkbox" aria-label="B·∫≠t/t·∫Øt Dark mode"
                    onchange="toggleDarkMode(this.checked)"> Dark mode
            </label> -->
        </div>

        <!-- Tab t·ª´ v·ª±ng -->
        <div id="vocabulary" class="tab-content active">
            <div class="filter-bar">
                <input id="searchInput" type="text" placeholder="T√¨m theo ch·ªØ H√°n / pinyin / nghƒ©a..."
                    aria-label="T√¨m ki·∫øm t·ª´ v·ª±ng">
                <select id="filterLesson" aria-label="L·ªçc theo b√†i h·ªçc">
                    <option value="all">T·∫•t c·∫£ b√†i</option>
                </select>
                <input id="filterTopic" type="text" placeholder="L·ªçc theo ch·ªß ƒë·ªÅ" aria-label="L·ªçc theo ch·ªß ƒë·ªÅ">
                <select id="filterGrammar" aria-label="L·ªçc theo t·ª´ lo·∫°i">
                    <option value="all">T·∫•t c·∫£ t·ª´ lo·∫°i</option>
                    <option value="N">N</option>
                    <option value="V">V</option>
                    <option value="Vs">Vs</option>
                    <option value="Vst">Vst</option>
                    <option value="Vaux">Vaux</option>
                    <option value="Adv">Adv</option>
                    <option value="Det">Det</option>
                    <option value="M">M</option>
                    <option value="Ptc">Ptc</option>
                </select>
                <select id="sortSelect" aria-label="S·∫Øp x·∫øp">
                    <option value="default">M·∫∑c ƒë·ªãnh</option>
                    <option value="chinese_asc">Ch·ªØ H√°n A‚ÜíZ</option>
                    <option value="chinese_desc">Ch·ªØ H√°n Z‚ÜíA</option>
                    <option value="pinyin_asc">Pinyin A‚ÜíZ</option>
                    <option value="pinyin_desc">Pinyin Z‚ÜíA</option>
                </select>
                <label class="inline-label"><input id="favOnly" type="checkbox" aria-label="Ch·ªâ hi·ªán t·ª´ y√™u th√≠ch"> Ch·ªâ
                    y√™u th√≠ch</label>
                <label class="inline-label"><input id="togglePinyin" type="checkbox" checked
                        aria-label="Hi·ªán ho·∫∑c ·∫©n Pinyin"> Hi·ªán Pinyin</label>
                <select id="cnDisplay" aria-label="Ki·ªÉu hi·ªÉn th·ªã ch·ªØ H√°n" onchange="setChineseDisplay(this.value)">
                    <option value="traditional">Hi·ªÉn th·ªã Ph·ªìn th·ªÉ</option>
                    <option value="simplified">Hi·ªÉn th·ªã Gi·∫£n th·ªÉ</option>
                </select>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalWords">0</div>
                    <div class="stat-label">T·ªïng t·ª´ v·ª±ng</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="lessons">3</div>
                    <div class="stat-label">B√†i h·ªçc</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="categories">5</div>
                    <div class="stat-label">Ch·ªß ƒë·ªÅ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="userWords">0</div>
                    <div class="stat-label">T·ª´ t√πy ch·ªânh</div>
                </div>
            </div>

            <div class="table-container">
                <table id="vocabularyTable">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>B√†i h·ªçc</th>
                            <th>Ch·ªß ƒë·ªÅ</th>
                            <th>Ch·ªØ H√°n</th>
                            <th>Pinyin</th>
                            <th>T·ª´ lo·∫°i</th>
                            <th>Nghƒ©a ti·∫øng Vi·ªát</th>
                            <th>V√≠ d·ª•</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="vocabularyBody">
                    </tbody>
                </table>
                <div class="pagination-controls">
                    <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:center;">
                        <button class="btn" id="pagePrev" onclick="changePage(-1)" style="padding:8px 14px;">‚¨ÖÔ∏è</button>
                        <span id="pageInfo" style="min-width:140px; display:inline-block; text-align:center;"></span>
                        <button class="btn" id="pageNext" onclick="changePage(1)" style="padding:8px 14px;">‚û°Ô∏è</button>
                        <span style="margin-left:10px;">Hi·ªÉn th·ªã</span>
                        <select id="pageSize" onchange="setPageSize(this.value)" aria-label="S·ªë h√†ng m·ªói trang">
                            <option value="25">25</option>
                            <option value="50" selected>50</option>
                            <option value="100">100</option>
                        </select>
                        <span>h√†ng</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab qu·∫£n l√Ω b√†i/ch·ªß ƒë·ªÅ -->
        <div id="manager" class="tab-content">
            <div class="manager">
                <h3 class="manager-title">üóÇÔ∏è Qu·∫£n l√Ω B√†i/Ch·ªß ƒë·ªÅ</h3>
                <div class="manager-grid">
                    <div class="manager-card">
                        <h5>B√†i h·ªçc</h5>
                        <table class="manager-table">
                            <tr>
                                <th style="width:160px;">Ch·ªçn b√†i</th>
                                <td><select id="manageLesson" aria-label="Ch·ªçn b√†i"></select></td>
                            </tr>
                            <tr>
                                <th>T√™n m·ªõi</th>
                                <td><input type="text" id="newLessonName" placeholder="T√™n b√†i m·ªõi / ƒë·ªïi t√™n"
                                        aria-label="T√™n b√†i h·ªçc"></td>
                            </tr>
                            <tr>
                                <th>H√†nh ƒë·ªông</th>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn" onclick="createLesson()">‚ûï T·∫°o b√†i</button>
                                        <button class="btn" onclick="renameLesson()">‚úèÔ∏è ƒê·ªïi t√™n b√†i</button>
                                        <button class="btn btn-danger" onclick="deleteLesson()">üóëÔ∏è X√≥a b√†i</button>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="manager-card">
                        <h5>Ch·ªß ƒë·ªÅ</h5>
                        <table class="manager-table">
                            <tr>
                                <th>Ch·ªß ƒë·ªÅ ngu·ªìn</th>
                                <td><input type="text" id="manageTopic" placeholder="Ch·ªß ƒë·ªÅ ngu·ªìn"
                                        aria-label="Ch·ªß ƒë·ªÅ ngu·ªìn"></td>
                            </tr>
                            <tr>
                                <th>ƒê√≠ch/ƒë·ªïi t√™n</th>
                                <td><input type="text" id="targetTopic" placeholder="T√™n m·ªõi / ch·ªß ƒë·ªÅ ƒë√≠ch"
                                        aria-label="Ch·ªß ƒë·ªÅ ƒë√≠ch ho·∫∑c t√™n m·ªõi"></td>
                            </tr>
                            <tr>
                                <th>H√†nh ƒë·ªông</th>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn" onclick="createTopic()">‚ûï T·∫°o ch·ªß ƒë·ªÅ</button>
                                        <button class="btn" onclick="renameTopic()">‚úèÔ∏è ƒê·ªïi t√™n ch·ªß ƒë·ªÅ</button>
                                        <button class="btn" onclick="mergeTopics()">üîÄ G·ªôp ch·ªß ƒë·ªÅ</button>
                                        <button class="btn btn-danger" onclick="deleteTopic()">üóëÔ∏è X√≥a ch·ªß ƒë·ªÅ</button>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="manager-card">
                        <h5>Th·ªëng k√™</h5>
                        <div class="stats-split">
                            <div>
                                <strong>Theo b√†i</strong>
                                <div class="stats-scroll">
                                    <table class="manager-stats-table">
                                        <thead>
                                            <tr>
                                                <th>T√™n</th>
                                                <th>S·ªë t·ª´</th>
                                            </tr>
                                        </thead>
                                        <tbody id="statsByLessonBody"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div>
                                <strong>Theo ch·ªß ƒë·ªÅ</strong>
                                <div class="stats-scroll">
                                    <table class="manager-stats-table">
                                        <thead>
                                            <tr>
                                                <th>T√™n</th>
                                                <th>S·ªë t·ª´</th>
                                            </tr>
                                        </thead>
                                        <tbody id="statsByTopicBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab th√™m t·ª´ m·ªõi -->
        <div id="add-word" class="tab-content">
            <div class="add-word-form">
                <h3>‚ûï Th√™m t·ª´ v·ª±ng m·ªõi</h3>
                <div class="grid-form">
                    <div class="form-group">
                        <label for="newLesson">B√†i h·ªçc:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <select id="newLesson" style="flex: 1;">
                                <option value="B√†i 1">B√†i 1</option>
                                <option value="B√†i 2">B√†i 2</option>
                                <option value="B√†i 3">B√†i 3</option>
                                <option value="T·ª´ m·ªõi">T·ª´ m·ªõi</option>
                                <option value="custom">T·∫°o b√†i m·ªõi...</option>
                            </select>
                            <button type="button" class="btn" onclick="showCustomLessonInput()" id="customLessonBtn"
                                style="display: none; padding: 8px 16px;">
                                ‚ûï
                            </button>
                        </div>
                        <input type="text" id="customLessonInput" placeholder="Nh·∫≠p t√™n b√†i h·ªçc m·ªõi"
                            style="display: none; margin-top: 8px;">
                    </div>

                    <div class="form-group">
                        <label for="newTopic">Ch·ªß ƒë·ªÅ:</label>
                        <input type="text" id="newTopic" placeholder="V√≠ d·ª•: Gia ƒë√¨nh, Th·ª©c ƒÉn...">
                    </div>

                    <div class="form-group">
                        <label for="newChinese">Ch·ªØ H√°n:</label>
                        <input type="text" id="newChinese" placeholder="V√≠ d·ª•: ‰Ω†Â•Ω" required>
                    </div>

                    <div class="form-group">
                        <label for="newPinyin">Pinyin:</label>
                        <input type="text" id="newPinyin" placeholder="V√≠ d·ª•: n«ê h«éo" required>
                    </div>

                    <div class="form-group">
                        <label for="newGrammar">T·ª´ lo·∫°i:</label>
                        <select id="newGrammar">
                            <option value="N">N - Danh t·ª´</option>
                            <option value="V">V - ƒê·ªông t·ª´</option>
                            <option value="Vs">Vs - T√≠nh t·ª´</option>
                            <option value="Vst">Vst - ƒê·ªông t·ª´ tr·∫°ng th√°i</option>
                            <option value="Vaux">Vaux - ƒê·ªông t·ª´ ph·ª•</option>
                            <option value="Adv">Adv - Tr·∫°ng t·ª´</option>
                            <option value="Det">Det - ƒê·ªãnh t·ª´</option>
                            <option value="M">M - L∆∞·ª£ng t·ª´</option>
                            <option value="Ptc">Ptc - Ng·ªØ kh√≠ t·ª´</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="newVietnamese">Nghƒ©a ti·∫øng Vi·ªát:</label>
                        <input type="text" id="newVietnamese" placeholder="V√≠ d·ª•: Xin ch√†o" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="newExample">V√≠ d·ª•:</label>
                    <input type="text" id="newExample" placeholder="V√≠ d·ª•: ‰Ω†Â•ΩÔºÅÂæàÈ´òÂÖ¥ËßÅÂà∞‰Ω†„ÄÇ">
                </div>

                <div style="text-align: center;">
                    <button class="btn" onclick="addNewWord()">‚ûï Th√™m t·ª´ v·ª±ng</button>
                    <button class="btn" onclick="clearForm()">üîÑ X√≥a form</button>
                </div>

                <!-- Qu·∫£n l√Ω d·ªØ li·ªáu c√° nh√¢n -->
                <div class="data-manager">
                    <h4 class="data-title">üìÅ Qu·∫£n l√Ω d·ªØ li·ªáu c√° nh√¢n</h4>

                    <!-- Export Section -->

                    <div class="data-section">
                        <h5 class="data-section-title export">üì§ Xu·∫•t d·ªØ li·ªáu</h5>
                        <div class="data-actions">
                            <button class="btn btn-excel" onclick="exportUserDataExcel()">üìä Export Excel
                                (.xlsx)</button>
                            <button class="btn btn-json" onclick="exportUserData()" style="display:none;">üíæ Export JSON
                                (.json)</button>
                        </div>
                    </div>

                    <!-- Import Section -->
                    <div class="data-section">
                        <h5 class="data-section-title import">üì• Nh·∫≠p d·ªØ li·ªáu</h5>
                        <div class="data-actions">
                            <button class="btn btn-import-excel" onclick="importUserDataExcel()">üìã Import Excel
                                (.xlsx)</button>
                            <button class="btn btn-import-json" onclick="importUserData()" style="display:none;">üìÇ
                                Import JSON
                                (.json)</button>
                        </div>
                    </div>


                    <!-- Danger Zone -->
                    <div class="danger-zone">
                        <h5>‚ö†Ô∏è V√πng nguy hi·ªÉm</h5>
                        <button class="btn btn-danger" onclick="clearLocalStorage()">üóëÔ∏è X√≥a t·∫•t c·∫£ t·ª´ ƒë√£
                            th√™m</button>
                    </div>

                    <div class="info-box">
                        <p>
                            <strong>üí° H∆∞·ªõng d·∫´n:</strong><br>
                            ‚Ä¢ <strong>Excel:</strong> D·ªÖ ch·ªânh s·ª≠a, c√≥ th·ªÉ m·ªü b·∫±ng Google Sheets, Excel<br>
                            ‚Ä¢ <strong>JSON:</strong> ƒê·ªãnh d·∫°ng nh·∫π, t∆∞∆°ng th√≠ch cao<br>
                            ‚Ä¢ <strong>D·ªØ li·ªáu:</strong> T·ª± ƒë·ªông l∆∞u tr√™n tr√¨nh duy·ªát, export ƒë·ªÉ backup
                        </p>
                    </div>

                </div>
            </div>
        </div>

        <!-- Tab l√†m b√†i t·∫≠p -->
        <div id="exercise" class="tab-content">
            <div class="exercise-section">
                <h3>‚úèÔ∏è L√†m b√†i t·∫≠p v·ªõi ki·ªÉm tra t·ª©c th√¨</h3>

                <div class="exercise-controls">
                    <div class="exercise-filters" style="display:flex; flex-wrap:wrap; gap:10px; align-items:center;">
                        <select id="exerciseType">
                            <option value="fillBlank">ƒêi·ªÅn ch·ªØ H√°n</option>
                            <option value="fillVietnamese">ƒêi·ªÅn nghƒ©a ti·∫øng Vi·ªát</option>
                            <option value="fillPinyin">ƒêi·ªÅn Pinyin</option>
                            <option value="multipleChoice">Tr·∫Øc nghi·ªám ch·ªØ H√°n</option>
                            <option value="multipleChoiceVietnamese">Tr·∫Øc nghi·ªám nghƒ©a</option>
                            <option value="trueFalse">ƒê√∫ng/Sai</option>
                            <option value="matching">N·ªëi t·ª´</option>
                            <option value="listening">Nghe Pinyin</option>
                            <option value="buildSentence">Gh√©p c√¢u</option>
                            <option value="sentenceFill">ƒêi·ªÅn t·ª´ trong c√¢u</option>
                        </select>

                        <select id="lessonFilter">
                            <option value="all">T·∫•t c·∫£ b√†i</option>
                            <option value="B√†i 1">B√†i 1</option>
                            <option value="B√†i 2">B√†i 2</option>
                            <option value="T·ª´ m·ªõi">T·ª´ m·ªõi</option>
                        </select>

                        <input type="number" id="questionCount" min="5" max="50" value="10"
                            style="width: 80px; padding: 10px; border-radius: 20px; border: 2px solid #ddd;">
                        <label for="questionCount">c√¢u</label>
                        <label class="inline-label" style="margin-left:10px;"><input id="dueOnly" type="checkbox"
                                aria-label="√în t·ª´ ƒë·∫øn h·∫°n"> √în t·ª´ ƒë·∫øn h·∫°n</label>
                        <label class="inline-label"><input id="recentMistakes" type="checkbox"
                                aria-label="√în l·∫°i c√¢u sai g·∫ßn ƒë√¢y"> √în l·∫°i c√¢u sai g·∫ßn ƒë√¢y</label>
                        <label class="inline-label"><input id="preferFavorites" type="checkbox"
                                aria-label="∆Øu ti√™n y√™u th√≠ch"> ∆Øu ti√™n y√™u th√≠ch</label>
                        <label class="inline-label"><input id="preferLowSRS" type="checkbox"
                                aria-label="∆Øu ti√™n √≠t th√†nh th·∫°o"> ∆Øu ti√™n √≠t th√†nh th·∫°o</label>
                    </div>

                    <button class="btn" onclick="startExercise()">üéØ B·∫Øt ƒë·∫ßu l√†m b√†i</button>
                    <button class="btn" onclick="stopExercise()" aria-label="D·ª´ng b√†i hi·ªán t·∫°i">‚èπÔ∏è D·ª´ng b√†i</button>
                </div>

                <div class="exercise-controls" style="margin-top: 8px;">
                    <label class="inline-label"><input id="mixMode" type="checkbox" aria-label="ƒê·ªÅ h·ªón h·ª£p theo t·ªâ l·ªá">
                        ƒê·ªÅ h·ªón h·ª£p theo t·ªâ l·ªá</label>
                    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                        <span style="font-size:12px; color:#555;">T·ªâ l·ªá (%):</span>
                        <label style="font-size:12px;">H‚ÜíV <input type="number" id="wFillVietnamese" value="0" min="0"
                                max="100" style="width:60px;"></label>
                        <label style="font-size:12px;">V‚ÜíH <input type="number" id="wFillBlank" value="0" min="0"
                                max="100" style="width:60px;"></label>
                        <label style="font-size:12px;">Pinyin <input type="number" id="wFillPinyin" value="0" min="0"
                                max="100" style="width:60px;"></label>
                        <label style="font-size:12px;">Tr·∫Øc nghi·ªám <input type="number" id="wMC" value="0" min="0"
                                max="100" style="width:80px;"></label>
                        <span style="font-size:12px; color:#777;">(T·ªïng c√≥ th·ªÉ kh√°c 100, h·ªá th·ªëng s·∫Ω chu·∫©n h√≥a)</span>
                        <div style="display:flex; gap:6px;">
                            <button class="btn" style="padding:6px 10px; font-size:12px;"
                                onclick="setPresetWeights(50,30,20,0)">50/30/20/0</button>
                            <button class="btn" style="padding:6px 10px; font-size:12px;"
                                onclick="setPresetWeights(25,25,25,25)">25/25/25/25</button>
                            <button class="btn" style="padding:6px 10px; font-size:12px;"
                                onclick="setPresetWeights(0,0,0,100)">0/0/0/100</button>
                        </div>
                    </div>
                </div>

                <div id="exerciseContainer" style="display: none;">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
                    </div>

                    <div class="score-display">
                        <span style="color: #4caf50;">‚úÖ ƒê√∫ng: <span id="correctCount">0</span></span>
                        <span style="margin: 0 20px;">|</span>
                        <span style="color: #f44336;">‚ùå Sai: <span id="incorrectCount">0</span></span>
                        <span style="margin: 0 20px;">|</span>
                        <span>C√¢u <span id="currentQuestion">1</span>/<span id="totalQuestions">0</span></span>
                        <span style="margin: 0 20px;">|</span>
                        <span>‚è±Ô∏è <span id="timerDisplay">00:00</span></span>
                    </div>

                    <div class="exercise-layout">
                        <div class="exercise-main">
                            <div id="questionCard" class="question-card"></div>
                            <div class="exercise-nav-row">
                                <!-- <button class="btn" onclick="previousQuestion()" id="prevBtn" aria-label="C√¢u tr∆∞·ªõc">‚¨ÖÔ∏è C√¢u tr∆∞·ªõc</button> -->
                                <button class="btn" onclick="finishExercise()" id="finishBtn" style="display: none;">üèÅ
                                    K·∫øt th√∫c</button>
                                <!-- <button class="btn" onclick="nextQuestion()" id="nextBtn" aria-label="C√¢u sau">C√¢u sau ‚û°Ô∏è</button> -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="exerciseResults"
                    style="display: none; margin-top: 20px; padding: 20px; background: white; border-radius: 10px;">
                    <h4>üéâ Ho√†n th√†nh b√†i t·∫≠p!</h4>
                    <div id="finalScore" style="font-size: 24px; font-weight: bold; margin: 15px 0;"></div>
                    <div id="encouragement" style="font-size: 18px; margin: 15px 0;"></div>
                    <div id="durationInfo" style="font-size: 14px; color:#666; margin: 8px 0;"></div>
                    <button class="btn" onclick="reviewMistakes()" id="reviewBtn">üìù Xem l·∫°i c√¢u sai</button>
                    <button class="btn" onclick="showHistory()" id="historyBtn">üìú L·ªãch s·ª≠ b√†i l√†m</button>
                </div>
            </div>

            <div class="history-section">
                <div class="history-header">
                    <h4>üìú L·ªãch s·ª≠ b√†i t·∫≠p</h4>
                    <div>
                        <button class="btn" onclick="exportHistory()" style="padding: 8px 14px;">üíæ Export</button>
                        <button class="btn btn-danger" onclick="clearHistory()" style="padding: 8px 14px;">üóëÔ∏è X√≥a l·ªãch
                            s·ª≠</button>
                    </div>
                </div>
                <div id="historyList" class="history-list"></div>
            </div>
        </div>

        <!-- Result Modal -->
        <div id="resultModal" class="modal">
            <div class="modal-content" style="max-width:700px;">
                <span class="close" onclick="closeResultModal()">&times;</span>
                <h3>üéâ Ho√†n th√†nh b√†i t·∫≠p!</h3>
                <div id="finalScoreModal" style="font-size:24px; font-weight:bold; margin:12px 0;"></div>
                <div id="encouragementModal" style="font-size:18px; margin: 8px 0;"></div>
                <div id="durationInfoModal" style="font-size:14px; color:#666; margin: 8px 0;"></div>
                <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
                    <button class="btn" onclick="reviewMistakes()" id="reviewBtnModal">üìù Xem l·∫°i c√¢u sai</button>
                    <button class="btn" onclick="showHistory()" id="historyBtnModal">üìú L·ªãch s·ª≠ b√†i l√†m</button>
                </div>
            </div>
        </div>

        <!-- Tab Flashcards -->
        <div id="flashcards" class="tab-content">
            <div class="flashcards-controls">
                <select id="fcLesson">
                    <option value="all">T·∫•t c·∫£ b√†i</option>
                    <option value="B√†i 1">B√†i 1</option>
                    <option value="B√†i 2">B√†i 2</option>
                    <option value="T·ª´ m·ªõi">T·ª´ m·ªõi</option>
                </select>
                <label class="inline-label"><input id="fcFavorites" type="checkbox" aria-label="Ch·ªâ hi·ªán t·ª´ y√™u th√≠ch">
                    Ch·ªâ y√™u th√≠ch</label>
                <label class="inline-label"><input id="fcTwoSided" type="checkbox" checked
                        aria-label="B·∫≠t random hai m·∫∑t"> Random 2 m·∫∑t</label>
                <label class="inline-label"><input id="fcAutoplay" type="checkbox" aria-label="T·ª± ƒë·ªông ph√°t √¢m">
                    Autoplay ph√°t √¢m</label>
                <select id="fcVoice" aria-label="Gi·ªçng ƒë·ªçc"></select>
                <label style="font-size:12px;">T·ªëc ƒë·ªô <input type="range" id="fcRate" min="0.5" max="1.5" step="0.1"
                        value="1" aria-label="T·ªëc ƒë·ªô ƒë·ªçc"></label>
                <select id="fcReadMode" aria-label="N·ªôi dung ƒë·ªçc">
                    <option value="pinyin">ƒê·ªçc Pinyin</option>
                    <option value="hanzi">ƒê·ªçc ch·ªØ H√°n</option>
                    <option value="both">ƒê·ªçc H√°n + Pinyin</option>
                </select>
                <button class="btn" onclick="initFlashcards()">üîÑ T·∫°o b·ªô th·∫ª</button>
            </div>
            <div class="flashcards-container">
                <div id="flashcard" class="flashcard" tabindex="0" onclick="flipFlashcard()">
                    <div id="flashFront" class="flash-face front"></div>
                    <div id="flashBack" class="flash-face back" style="display:none;"></div>
                </div>
                <div class="flashcards-nav">
                    <button class="btn" onclick="prevFlashcard()">‚¨ÖÔ∏è Tr∆∞·ªõc</button>
                    <span id="flashInfo" style="min-width:120px; text-align:center;"></span>
                    <button class="btn" onclick="nextFlashcard()">Sau ‚û°Ô∏è</button>
                    <button class="btn" onclick="speakFlashcard()">üîä Ph√°t √¢m</button>
                </div>
                <div class="flashcards-hint">Ph√≠m t·∫Øt: Space (l·∫≠t), ‚Üê/‚Üí (tr∆∞·ªõc/sau), A (ph√°t √¢m)</div>
            </div>
        </div>

        <!-- Tab ti·∫øn ƒë·ªô -->
        <div id="progress" class="tab-content">
            <div class="exercise-section">
                <h3>üìà Ti·∫øn ƒë·ªô h·ªçc t·∫≠p</h3>
                <div class="exercise-controls progress-filters"
                    style="margin-bottom:10px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
                    <label for="progFrom">T·ª´ ng√†y</label><input type="date" id="progFrom" aria-label="T·ª´ ng√†y">
                    <label for="progTo">ƒê·∫øn ng√†y</label><input type="date" id="progTo" aria-label="ƒê·∫øn ng√†y">
                    <select id="progLesson" aria-label="L·ªçc theo b√†i"></select>
                    <select id="progType" aria-label="L·ªçc theo lo·∫°i b√†i">
                        <option value="all">T·∫•t c·∫£ lo·∫°i</option>
                        <option value="fillBlank">ƒêi·ªÅn ch·ªØ H√°n</option>
                        <option value="fillVietnamese">ƒêi·ªÅn nghƒ©a Vi·ªát</option>
                        <option value="fillPinyin">ƒêi·ªÅn Pinyin</option>
                        <option value="multipleChoice">Tr·∫Øc nghi·ªám H√°n</option>
                        <option value="multipleChoiceVietnamese">Tr·∫Øc nghi·ªám nghƒ©a</option>
                        <option value="trueFalse">ƒê√∫ng/Sai</option>
                        <option value="matching">N·ªëi t·ª´</option>
                        <option value="listening">Nghe Pinyin</option>
                        <option value="buildSentence">Gh√©p c√¢u</option>
                        <option value="sentenceFill">ƒêi·ªÅn t·ª´ trong c√¢u</option>
                    </select>
                    <button class="btn" onclick="applyProgressFiltersUI()">L·ªçc</button>
                    <button class="btn" onclick="resetProgressFilters()"
                        style="background: linear-gradient(45deg, #64748b, #475569);">X√≥a l·ªçc</button>
                </div>
                <div class="progress-grid">
                    <div class="card">
                        <h5>Ng√†y g·∫ßn ƒë√¢y</h5>
                        <canvas id="dailyChart" width="400" height="160"></canvas>
                    </div>
                    <div class="card">
                        <h5>Tu·∫ßn g·∫ßn ƒë√¢y</h5>
                        <canvas id="weeklyChart" width="400" height="160"></canvas>
                    </div>
                </div>
                <div class="progress-grid" style="margin-top:10px;">
                    <div class="card" style="grid-column: 1 / -1;">
                        <h5>Chi ti·∫øt theo ng√†y</h5>
                        <canvas id="dailyDetailChart" width="800" height="200"></canvas>
                        <div id="dailyDetailInfo" style="font-size:12px; color:#666; margin-top:6px;"></div>
                        <table class="mini-table" style="margin-top:8px;">
                            <thead>
                                <tr>
                                    <th>Th·ªùi ƒëi·ªÉm</th>
                                    <th>Lo·∫°i</th>
                                    <th>B√†i</th>
                                    <th>ƒêi·ªÉm</th>
                                    <th>S·ªë c√¢u</th>
                                    <th>Th·ªùi gian (s)</th>
                                </tr>
                            </thead>
                            <tbody id="dailyDetailBody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="progress-grid" style="margin-top:10px;">
                    <div class="card">
                        <h5>T·ªâ l·ªá ƒë√∫ng theo lo·∫°i b√†i</h5>
                        <table class="mini-table">
                            <thead>
                                <tr>
                                    <th>Lo·∫°i</th>
                                    <th>ƒê√∫ng</th>
                                    <th>T·ªïng</th>
                                    <th>%</th>
                                    <th>S·ªë b√†i</th>
                                    <th>Th·ªùi gian TB (s/c√¢u)</th>
                                </tr>
                            </thead>
                            <tbody id="byTypeBody"></tbody>
                        </table>
                    </div>
                    <div class="card">
                        <h5>T·ªâ l·ªá ƒë√∫ng theo t·ª´ lo·∫°i</h5>
                        <table class="mini-table">
                            <thead>
                                <tr>
                                    <th>T·ª´ lo·∫°i</th>
                                    <th>Sai</th>
                                    <th>% trong l·ªói</th>
                                    <th>T·ª´ sai ti√™u bi·ªÉu</th>
                                </tr>
                            </thead>
                            <tbody id="byGrammarBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab t·∫£i xu·ªëng -->
        <div id="download" class="tab-content">
            <div
                style="text-align: center; padding: 30px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 15px;">
                <h3>üì• T·∫£i xu·ªëng file Excel</h3>
                <p>File Excel s·∫Ω bao g·ªìm t·∫•t c·∫£ t·ª´ v·ª±ng v·ªõi c√°c worksheet ri√™ng bi·ªát cho t·ª´ng b√†i h·ªçc</p>
                <button class="btn" onclick="downloadExcel()">üìä T·∫£i Excel - T·∫•t c·∫£ t·ª´ v·ª±ng</button>
                <button class="btn" onclick="downloadFlashcards()">üÉè T·∫£i Excel - Flashcards</button>
                <button class="btn" onclick="downloadExercises()">‚úèÔ∏è T·∫£i Excel - B√†i t·∫≠p t·ª± ƒë·ªông</button>
            </div>
        </div>
    </div>

    <!-- Modal xem l·∫°i c√¢u sai -->
    <!-- Modal ch·ªânh s·ª≠a t·ª´ v·ª±ng -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReviewModal()">&times;</span>
            <h3>üìù Xem l·∫°i c√¢u sai</h3>
            <div id="reviewContent"></div>
        </div>
    </div>

    <!-- Modal l·ªãch s·ª≠ chi ti·∫øt -->
    <div id="historyModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close" onclick="closeHistoryModal()">&times;</span>
            <h3>üìú Chi ti·∫øt b√†i l√†m</h3>
            <div id="historyDetail"></div>
        </div>
    </div>

    <!-- Modal ch·ªânh s·ª≠a t·ª´ v·ª±ng -->
    <div id="editModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h3>‚úèÔ∏è Ch·ªânh s·ª≠a t·ª´ v·ª±ng</h3>
            <form id="editForm" style="text-align: left;">
                <div class="grid-form">
                    <div class="form-group">
                        <label for="editLesson">B√†i h·ªçc:</label>
                        <select id="editLesson">
                            <option value="B√†i 1">B√†i 1</option>
                            <option value="B√†i 2">B√†i 2</option>
                            <option value="B√†i 3">B√†i 3</option>
                            <option value="T·ª´ m·ªõi">T·ª´ m·ªõi</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editTopic">Ch·ªß ƒë·ªÅ:</label>
                        <input type="text" id="editTopic" placeholder="V√≠ d·ª•: Gia ƒë√¨nh, Th·ª©c ƒÉn...">
                    </div>

                    <div class="form-group">
                        <label for="editChinese">Ch·ªØ H√°n:</label>
                        <input type="text" id="editChinese" placeholder="V√≠ d·ª•: ‰Ω†Â•Ω" required>
                    </div>

                    <div class="form-group">
                        <label for="editPinyin">Pinyin:</label>
                        <input type="text" id="editPinyin" placeholder="V√≠ d·ª•: n«ê h«éo" required>
                    </div>

                    <div class="form-group">
                        <label for="editGrammar">T·ª´ lo·∫°i:</label>
                        <select id="editGrammar">
                            <option value="N">N - Danh t·ª´</option>
                            <option value="V">V - ƒê·ªông t·ª´</option>
                            <option value="Vs">Vs - T√≠nh t·ª´</option>
                            <option value="Vst">Vst - ƒê·ªông t·ª´ tr·∫°ng th√°i</option>
                            <option value="Vaux">Vaux - ƒê·ªông t·ª´ ph·ª•</option>
                            <option value="Adv">Adv - Tr·∫°ng t·ª´</option>
                            <option value="Det">Det - ƒê·ªãnh t·ª´</option>
                            <option value="M">M - L∆∞·ª£ng t·ª´</option>
                            <option value="Ptc">Ptc - Ng·ªØ kh√≠ t·ª´</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editVietnamese">Nghƒ©a ti·∫øng Vi·ªát:</label>
                        <input type="text" id="editVietnamese" placeholder="V√≠ d·ª•: Xin ch√†o" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editExample">V√≠ d·ª•:</label>
                    <input type="text" id="editExample" placeholder="V√≠ d·ª•: ‰Ω†Â•ΩÔºÅÂæàÈ´òÂÖ¥ËßÅÂà∞‰Ω†„ÄÇ">
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button type="button" class="btn" onclick="saveEditedWord()">üíæ L∆∞u thay ƒë·ªïi</button>
                    <button type="button" class="btn" onclick="closeEditModal()"
                        style="background: linear-gradient(45deg, #757575, #616161);">‚ùå H·ªßy</button>
                </div>
            </form>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>

</html>